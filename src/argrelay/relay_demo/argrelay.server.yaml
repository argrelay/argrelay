# Sample config for `argrelay` server.
# To test, symlink this files as user dot file - see `dev-init.bash` script.

connection_config:
    server_host_name: localhost
    server_port_number: 8787

mongo_config:
    client_connection_string: mongodb://test:test@localhost/test?authSource=admin
    # TODO: change to `argrelay`:
    database_name: test
    start_server: True
    server_start_command: ~/argrelay.git/temp/mongo/mongodb-linux-x86_64-rhel80-6.0.3/bin/mongod --dbpath ~/argrelay.git/temp/mongo/data

plugin_list:
    -   plugin_id: FirstArgInterpFactory
        plugin_module_name: argrelay.plugin_interp.FirstArgInterpFactory
        plugin_class_name: FirstArgInterpFactory
        plugin_type: InterpFactoryPlugin
        plugin_config:
            first_arg_vals_to_next_interp_factory_ids:
                # This binding uses existing script `relay_demo`:
                relay_demo: DemoInterpFactory
                # Another equivalent binding (but `some_command` does not exist in this repo):
                some_command: DemoInterpFactory

    -   plugin_id: DemoInterpFactory
        plugin_module_name: argrelay.relay_demo.DemoInterpFactory
        plugin_class_name: DemoInterpFactory
        plugin_type: InterpFactoryPlugin
        plugin_config:
            # TODO: Is `function_query` always supposed to repeat `envelope_class_queries` for `envelope_class` = `ClassFunction`?
            function_query:
                envelope_class: ClassFunction
                keys_to_types_list:
                    -   action: ActionType
                    -   selector: ObjectSelector
            envelope_class_queries:
                -   envelope_class: ClassFunction
                    keys_to_types_list:
                        -   action: ActionType
                        -   selector: ObjectSelector
                -   envelope_class: ClassHost
                    keys_to_types_list:
                        -   code: CodeMaturity
                        -   stage: FlowStage
                        -   region: GeoRegion
                        -   host: HostName
                        -   tag: ColorTag
                -   envelope_class: ClassService
                    keys_to_types_list:
                        -   code: CodeMaturity
                        -   stage: FlowStage
                        -   region: GeoRegion
                        -   host: HostName
                        -   service: ServiceName
                        # TODO: AccessType should be part of selecting another class or simply an arg to function (it is not used to find service, it is used to select how to access it):
                        -   access: AccessType
                        -   tag: ColorTag
                -   envelope_class: ClassGitRepo
                    keys_to_types_list:
                        -   part: GitRepoPathComp
                        -   path: GitRepoRelPath
                -   envelope_class: ClassGitCommit
                    keys_to_types_list:
                        -   path: GitRepoRelPath
                        -   email: GitRepoCommitAuthorEmail
                        -   hex: GitRepoCommitId

    -   plugin_id: NoopLoader
        plugin_module_name: argrelay.misc_helper.NoopLoader
        plugin_class_name: NoopLoader
        plugin_type: LoaderPlugin
        plugin_config: { }

    -   plugin_id: ServiceLoader
        plugin_module_name: argrelay.relay_demo.ServiceLoader
        plugin_class_name: ServiceLoader
        plugin_type: LoaderPlugin
        plugin_config:

            types_to_values:

                ColorTag:
                    - red
                    - green

    -   plugin_id: GitRepoLoader
        plugin_module_name: argrelay.relay_demo.GitRepoLoader
        plugin_class_name: GitRepoLoader
        plugin_type: LoaderPlugin
        plugin_config:
            is_enabled: False
            base_path: "~/repos"

    -   plugin_id: GitRepoInvocator
        plugin_module_name: argrelay.relay_demo.GitRepoInvocator
        plugin_class_name: GitRepoInvocator
        plugin_type: InvocatorPlugin
        plugin_config: { }

    -   plugin_id: NoopInvocator
        plugin_module_name: argrelay.plugin_invocator.NoopInvocator
        plugin_class_name: NoopInvocator
        plugin_type: InvocatorPlugin
        plugin_config: { }

# Statically defined `static_data` - and it is not a tautology!
# This data is loaded as part of the config on start (and will be available even when all loader plugins removed).
# Loader plugins are also supposed to add more data (but they also can modify or completely remove it).
static_data:

    first_interp_factory_id: FirstArgInterpFactory

    types_to_values:

        # TODO: only define list of types, populating `types_to_values` should be automatic from all loaded envelopes:
        ActionType:
            - goto
            - desc
            - list

        ObjectSelector:
            - host
            - service
            - repo
            - commit

        CodeMaturity:
            - dev
            - qa
            - prod

        FlowStage:
            - upstream
            - downstream

        GeoRegion:
            - amer
            - emea
            - apac

        # Host names are just some strings with prefixes for testing:
        HostName:
            - qw
            - qwe
            - qwer
            - wert

            - as
            - asd
            - asdf
            - sdfg

            - zx
            - zxc
            - zxcv
            - xcvb

        ServiceName:
            - service_a
            - service_b
            - service_c

        AccessType:
            - ro
            - rw

        ColorTag: [ ]

    data_envelopes: [ ]
